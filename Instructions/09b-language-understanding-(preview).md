---
lab:
  title: 使用語言服務建立語言理解模型 (預覽)
ms.openlocfilehash: 92d556e50c8f5c827e16f1e5ad301d3b59c1ad6e
ms.sourcegitcommit: cb2edc850cec8390a81212d9b8f6a279d2f42b4d
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/04/2022
ms.locfileid: "145195542"
---
# <a name="create-a-language-understanding-model-with-the-language-service-preview"></a>使用語言服務建立語言理解模型 (預覽)

> **注意**：語言服務的交談語言理解功能目前處於預覽狀態，而且可能會變更。 在某些情況下，模型定型可能會失敗 - 如果發生這種情況，請重新嘗試一次。  

語言服務可讓您定義 *交談語言理解* 模型，而應用程式可使用該模型來解譯使用者自然語言輸入、預測使用者 *意圖* (他們想要達成的目的)，以及識別應套用意圖的任何 *實體*。

例如，適用於時鐘應用程式的交談語言模型可能需要處理輸入，例如：

*倫敦現在幾點？*

這種輸入是 *表達* 的範例，(使用者可能會說出或輸入的東西)，其 *意圖* 是取得特定位置 (*實體*) 的時間；在此案例中為倫敦。

> **注意**：交談語言模型的工作是預測使用者的意圖，並識別套用意圖的任何實體。 實際執行滿足意圖所需的動作<u>並非</u>交談語言模型的工作。 例如，時鐘應用程式可以使用交談語言模型來辨識使用者想要知道倫敦的時間；但用戶端應用程式本身必須接下來實作邏輯，以判斷正確的時間，並將其呈現給使用者。

## <a name="create-a-language-service-resource"></a>建立語言服務資源

若要建立交談語言模型，您需要支援區域中的 **語言服務** 資源。 在撰寫本文時，僅支援美國西部 2 和西歐區域。

1. 開啟位於 `https://portal.azure.com` 的 Azure 入口網站，使用與您的 Azure 訂用帳戶相關聯的 Microsoft 帳戶進行登入。
2. 按一下 [&#65291；建立資源] 按鈕，搜尋 [語言服務] ，然後使用下列設定建立 **語言服務** 資源。

    - **功能**：使用預設功能，包括交談語言理解 (預覽) 
    - **訂用帳戶**：Azure 訂閱
    - **資源群組**：*選擇或建立資源群組 (如果您使用受限制的訂用帳戶，則可能沒有建立新資源群組的權限 - 請使用所提供的資源群組)*
    - **區域**：美國西部 2 或西歐
    - **名稱**：*輸入唯一名稱*
    - **定價層**：選取標準 (S) 層級（免費層級目前未支援交談語言理解）。
    - **法律條款**：_同意_ 
    - **負責任 AI 注意事項**：_同意_
3. 等候部署完成，然後檢視部署的詳細資料。

## <a name="create-a-conversational-language-understanding-project"></a>建立交談語言理解專案

既然您已建立製作資源，您可以使用其來建立交談語言理解專案。

1. 在新的瀏覽器索引標籤中，開啟位於 `https://language.cognitive.azure.com/` 的 語言工作室入口網站，然後使用與您的 Azure 訂用帳戶相關聯的 Microsoft 帳戶進行登入。

2. 若系統提示您選擇語言資源，請選取下列設定：

    - **Azure 目錄**：包含您訂用帳戶的 Azure 目錄。
    - **Azure 訂用帳戶**：您的 Azure 訂閱。
    - **語言資源**：您先前建立的語言資源。

3. 如果<u>未</u>提示您選擇語言資源，可能是因為您已指派不同的語言資源；在此情況下：

    1. 在分頁頂端的列上，按一下 [設定 (&#9881;)] 按鈕。
    2. 在 [設定] 分頁上，檢視 [資源] 索引標籤。
    3. 選取您剛才建立的語言資源，然後按一下 [切換資源]。
    4. 在頁面頂端，按一下 [語言工作室] 以返回 語言工作室首頁。

4. 在入口網站頂端的 [新建] 功能表中，選取 [交談語言理解] 。

5. 在 [建立專案] 對話方塊的 [輸入基本資訊] 頁面上，輸入下列詳細資料，然後按 [下一步]：
    - **名稱**：`Clock`
    - **描述**：`Natural language clock`
    - **表達主要語言**：英文
    - **在專案中啟用多種語言？** ：*未選取*

7. 在 [檢閱和完成] 頁面上，按一下 [建立]。

## <a name="create-intents"></a>建議意圖

我們在新專案中做的第一件事是定義一些意圖。

> **秘訣**：處理您的專案時，如果顯示一些秘訣，請閱讀這些秘訣，然後按一下 [知道了] 將其關閉，或按一下 [全部略過]。

1. 在 [組建結構描述] 頁面上的 [意圖] 索引標籤上，選取 [&#65291;新增] 以新增名為 **GetTime** 的新意圖。

2. 按一下新的 **GetTime** 意圖對其進行編輯，新增下列表達作為範例使用者輸入：

    `what is the time?`

    `what's the time?`

    `what time is it?`

    `tell me the time`

3. 新增這些表達之後，按一下 [儲存變更] ，然後返回 [組建結構描述] 頁面。

4. 使用下列表達新增另一個名為 **GetDay** 的新意圖：

    `what day is it?`

    `what's the day?`

    `what is the day today?`

    `what day of the week is it?`

5. 新增這些表達並加以儲存之後，請返回 [組建結構描述] 頁面，並使用下列表達新增另一個名為 **GetDate** 的新意圖：

    `what date is it?`

    `what's the date?`

    `what is the date today?`

    `what's today's date?`

6. 新增這些表達之後，請儲存這些表達，並清除表達頁面上的 **GetDate** 篩選條件，讓您可以查看所有意圖的所有表達。

## <a name="train-and-test-the-model"></a>定型和測試模型

既然您已新增一些意圖，讓我們定型該語言模型，並查看其是否可以正確地從使用者輸入預測意圖。

1. 在左側窗格中，選取 [定型模型] 頁面，然後選取 [啟動定型作業]。

2. 在 [啟動定型作業] 對話方塊中，選取將新模型定型的選項，將其命名為 [時鐘] ，並確認啟用定型時執行評估的選項。 

3. 若要開始定型模型的流程，請按一下 [定型] 。

4. 當定型完成時 (可能需要幾分鐘的時間)，作業 [狀態] 將會變更為 [訓練成功]。

5. 選取 [檢視模型詳細資料] 頁面，然後選取 [時鐘] 模型。 檢閱整體和每個意圖評估衡量標準 (*精確度*、*召回率* 及 *F1 分數*)，以及在定型時執行評估所產生的 *混淆矩陣*(請注意，由於範例表達數目較少，並非所有意圖都可能包含在結果) 。

    >**注意**：若要深入了解評估衡量標準，請參閱[文件](https://docs.microsoft.com/azure/cognitive-services/language-service/conversational-language-understanding/concepts/evaluation-metrics)

5. 在 [部署模型] 頁面上，選取 [新增部署] 。

5. 在 [新增部署] 對話方塊中，選取 [建立新的部署名稱] ，然後輸入 [生產環境] 

5. 選取 [時鐘] 模型，然後按一下 [提交] 。 此部屬操作可能會需要一些時間。

6. 部署模型之後，在 [測試模型] 頁面上，選取 [時鐘] 模型。

6. 在 **測試模型上：[時鐘]** 分頁的 [部署名稱] 下拉式選單中，選取 [生產環境]。  

7. 輸入下列文字，然後按一下 [執行測試]：

    `what's the time now?`

    檢閱傳回的結果，注意其包含預測的意圖 (應該是 **GetTime**)，並包含信賴度分數指出模型針對預測的意圖計算出的可能性。 [JSON] 索引標籤顯示每個可能意圖的比較信賴度 (信賴分數最高的意圖就是預測的意圖)

8. 請清除文字方塊，然後使用下列文字執行另一個測試：

    `tell me the time`

    再次檢閱預測的意圖和信賴性分數。

9. 嘗試下列文字：

    `what's the day today?`

    但願模型預測 **GetDay** 意圖。

## <a name="add-entities"></a>新增實體

到目前為止，您已定義一些對應至意圖的簡單表達。 大部分的實際應用程式都包含更複雜的表達，必須從中擷取特定資料實體，以取得意圖的更多內容。

### <a name="add-a-learned-entity"></a>新增 *已學習* 實體

最常見的實體類型是 *已學習* 實體，模型會學習根據範例來識別實體值。

1. 在 [語言工作室] 中，返回 [組建結構描述] 頁面，然後在 [實體] 索引標籤上，選取 [&#65291; 新增] 以新增實體。

2. 在 [新增實體] 對話方塊中，輸入實體名稱 [位置] ，並確定已選取 [已學習]。 然後按一下 [新增實體]。

3. 建立 **位置** 實體之後，返回 [組建結構描述] 頁面，然後在 [意圖] 索引標籤上選取 [GetTime] 意圖。

4. 輸入下列新的範例表達：

    `what time is it in London?`

5. 新增表達之後，請選取 [*London_] 這個字，然後在出現的下拉式清單中，選取 [_Location*] 以指出 「London」 是位置的範例。

6. 新增另一個表達範例：

    `Tell me the time in Paris?`

7. 新增表達之後，請選取 [*Paris_] 這個字，並將其對應至 [_Location*] 實體。

8. 新增另一個表達範例：

    `what's the time in New York?`

9. 新增表達之後，請選取 [*New York_] 這個字，並將其對應至 [_Location*] 實體。

10. 按一下 [儲存變更] 以儲存新的表達。

### <a name="add-a-list-entity"></a>新增 *清單* 實體

在某些情況下，實體的有效值可以限制為以特定字詞和同義字構成的清單；其可協助應用程式識別表達中實體的執行個體。

1. 在 [語言工作室] 中，返回 [組建結構描述] 頁面，然後在 [實體] 索引標籤上，選取 [&#65291;新增] 以新增實體。

2. 在 [新增實體] 對話方塊中，輸入實體名稱 [平日] ，然後選取 [清單] 實體類型。 然後按一下 [新增實體]。

3. 在 [平日] 實體的頁面上，按一下 [清單] 區段中的 [&#65291;新增清單]。 然後輸入下列值和同義字，然後按一下 [儲存] ：

    | 列出索引鍵 | 同義字|
    |-------------------|---------|
    | 星期日 | Sun |

4. 重複上一個步驟以新增下列清單元件：

    | 值 | 同義字|
    |-------------------|---------|
    | 星期一 | Mon |
    | Tuesday | Tue、Tues |
    | 星期三 | Wed、Weds |
    | Thursday | Thur、Thurs |
    | 星期五 | Fri |
    | 星期六 | Sat |

5. 返回 [組建結構描述] 頁面，然後在 [意圖] 索引標籤上，選取 [GetDate] 意圖。

6. 輸入下列新的範例表達：

    `what date was it on Saturday?`

7. 新增表達之後，請選取 [*Saturday_] 這個字，然後在出現的下拉式清單中選取 [_*Weekday**]。

8. 新增另一個表達範例：

    `what date will it be on Friday?`

9. 當表達已被新增時，請將 [星期五] 對應至 [平日] 實體。

10. 新增另一個表達範例：

    `what will the date be on Thurs?`

11. 當表達已新增時，請將 [星期四] 對應至 [平日] 實體。

12. 按一下 [儲存變更] 以儲存新的表達。

### <a name="add-a-prebuilt-entity"></a>新增 *預先建置* 的實體

語言服務會提供一組常用於交談應用程式中的 *預先建置* 實體。

1. 在 [語言工作室] 中，返回 [組建結構描述] 頁面，然後在 [實體] 索引標籤上，選取 [&#65291;新增] 以新增實體。

2. 在 [新增實體] 對話方塊中，輸入實體名稱 [日期] ，然後選取 [預先建置] 實體類型。 然後按一下 [新增實體]。

3. 在 [日期] 實體的頁面上，按一下 [預先建置] 區段中的 [&#65291;新增預先建置]。

4. 在 [選取預先建置] 清單中，選取 [日期時間]，然後按一下 [儲存]。

5. 返回 [組建結構描述] 頁面，然後在 [意圖] 索引標籤上，選取 [GetDate] 意圖。

6. 輸入下列新的範例表達：

    `what day was 01/01/1901?`

7. 新增表達之後，請選取 [*01/01/1901_] 這段字詞，然後在出現的下拉式清單中選取 [_*日期**]。

8. 新增另一個表達範例：

    `what day will it be on Dec 31st 2099?`

9. 當已新增表達時，請將 **2099 年 12 月 31 日** 對應至 [日期] 實體。

10. 按一下 [儲存變更] 以儲存新的表達。

### <a name="retrain-the-model"></a>重新定型模型

既然您已修改結構描述，您必須重新定型並重新測試模型。

1. 在 [定型模型] 頁面上，選取 [開始定型作業] 。

1. 在 [啟動定型作業] 對話方塊中，選取覆寫現有模型並指定 [時鐘] 模型的選項。 請確認選取定型時要執行評估的選項，然後按一下 [ 定型] 以定型模型；確認您想要覆寫現有的模型。

2. 當定型完成時，作業 **狀態** 會更新為 [定型成功]。 

2. 選取 [檢視模型詳細資料] 頁面，然後選取 [時鐘] 模型。 檢閱整體和每個意圖評估衡量標準 (*精確度*、*召回率* 及 *F1 分數*)，以及在定型時執行評估所產生的 *混淆矩陣* (請注意，由於範例表達數目較少，並非所有意圖都可能包含在結果) 。

3. 在 [部署模型] 頁面上，選取 [新增部署] 。

3. 在 [新增部署] 對話方塊中，選取 [覆寫現有的部署名稱] ，然後選取 [生產環境] 。

3. 選取 [時鐘] 模型，然後按一下 [提交] 來部署該模型。 這可能需要一些時間。

4. 部署模型時，在 [測試模型] 頁面上，選取 [時鐘] 模型、選取 [生產環境] 部署，然後使用下列文字進行測試：

    `what's the time in Edinburgh?`

5. 檢閱傳回的結果，其但願應該是預測 **GetTime** 意圖和 **位置** 實體，文字值為「Edinburgh」。

6. 嘗試測試下列表達：

    `what time is it in Tokyo?`
    
    `what date is it on Friday?`

    `what's the date on Weds?`

    `what day was 01/01/2020?`

    `what day will Mar 7th 2030 be?`

## <a name="use-the-model-from-a-client-app"></a>從用戶端應用程式使用模型

在實際專案中，您會反復完善意圖和實體、重新定型及重新測試，直到您滿意預測效能為止。 然後，當您進行測試並滿意其預測效能時，您可以藉由呼叫其 REST 介面，在用戶端應用程式中加以使用。 在此練習中，您將使用 *curl* 公用程式來呼叫您模型的 REST 端點。

1. 在語言工作室的 [部署模型] 頁面上，選取 [時鐘] 模型。 接著，按一下 [取得預測 URL]。

2. 請注意，在 [取得預測 URL] 對話方塊中，預測端點的 URL 會連同範例要求一起顯示，其中包含將 HTTP POST 要求提交至端點的 **curl** 命令，並在標頭中指定您語言資源的索引鍵，並在要求資料中包含查詢和語言。

3. 複製範例要求，並將其貼到您合意的文字編輯器 (例如記事本)。

4. 取代下列預留位置：
    - **在此輸入您的查詢**：*What's the time in Sydney? (雪梨現在幾點？)*
    - **在此輸入查詢語言**：*EN*

    命令應該如以下程式碼所示：

    ```
    curl -X POST "https://some-name.cognitiveservices.azure.com/language/:analyze-conversations?projectName=Clock&deploymentName=production&api-version=2021-11-01-preview" -H "Ocp-Apim-Subscription-Key: 0ab1c23de4f56..."  -H "Apim-Request-Id: 9zy8x76wv5u43...." -H "Content-Type: application/json" -d "{\"verbose\":true,\"query\":\"What's the time in Sydney?\",\"language\":\"EN\"}"
    ```

5. 開啟命令提示字元 (Windows) 或 bash shell (Linux/Mac)。

6. 將編輯的 curl 命令複製並貼到您的命令列介面並加以執行。

7. 檢視產生的 JSON，其中應該包含預測意圖和實體，如下所示：

    ```
    {"query":"What's the time in Sydney?","prediction":{"topIntent":"GetTime","projectKind":"conversation","intents":[{"category":"GetTime","confidenceScore":0.9998859},{"category":"GetDate","confidenceScore":9.8372206E-05},{"category":"GetDay","confidenceScore":1.5763446E-05}],"entities":[{"category":"Location","text":"Sydney","offset":19,"length":6,"confidenceScore":1}]}}
    ```

8. 檢閱您模型傳回的 JSON 回應，以確保預測的最高評分意圖為 **GetTime**。

9. 將 curl 命令中的查詢變更為 `What's today's date?`，然後加以執行並檢閱產生的 JSON。

10. 請嘗試下列查詢：

    `What day will Jan 1st 2050 be?`

    `What time is it in Glasgow?`

    `What date will next Monday be?`

## <a name="export-the-project"></a>匯出專案

您可以使用語言工作室來開發和測試您的語言理解模型，但在 適用於 DevOps 的軟體發展程式中，您應該維護可包含在持續整合和傳遞 (CI/CD) 管線中的專案原始檔控制定義。 雖然您 *可以* 在程式碼指令碼中使用語言 REST API 來建立和定型模型，但更簡單的方法是使用入口網站來建立模型結構描述，並將其匯出為可在另一個語言服務實例中匯入和重新定型的 *.json* 檔案。 此方法可讓您利用語言工作室視覺化介面的生產力優勢，同時維護模型的可攜性和重現性。

1. 在語言工作室的 [專案] 頁面上，選取 [時鐘] 專案。 請勿按下 [時鐘] ，請選取圓形圖示以選取 [時鐘] 專案。

2. 按一下 [&#x2913;匯出] 按鈕。

3. 儲存產生的 **Clock.json** 檔案 (在任何你想要的地方)。

4. 在您喜歡的程式碼編輯器 (例如 Visual Studio Code) 中開啟下載的檔案，以檢閱您專案的 JSON 定義。

## <a name="more-information"></a>詳細資訊

如需使用 **語言** 服務建立交談語言理解解決方案的詳細資訊，請參閱[語言服務文件](https://docs.microsoft.com/azure/cognitive-services/language-service/conversational-language-understanding/overview)。
