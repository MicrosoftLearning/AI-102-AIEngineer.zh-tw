---
lab:
  title: 建立語言理解應用程式
  module: Module 5 - Creating Language Understanding Solutions
ms.openlocfilehash: d8a32a2b6404e81d8a5d69cef874fad209de1bfc
ms.sourcegitcommit: d6da3bcb25d1cff0edacd759e75b7608a4694f03
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/16/2021
ms.locfileid: "145195534"
---
# <a name="create-a-language-understanding-app"></a>建立語言理解應用程式

Language Understanding 服務可讓您定義一個封裝語言模型的應用程式，而應用程式可使用該語言模型來解譯使用者自然語言輸入、預測使用者 *意圖* (他們想要達成的目的)，以及識別應套用意圖的任何 *實體*。

例如，適用於時鐘應用程式的語言理解應用程式可能需要處理輸入，例如：

*What is the time in London?*

這種輸入是 *表達* 的範例，(使用者可能會說出或鍵入的東西)，其 *意圖* 是取得特定位置 (*實體*) 的時間；在此案例中為倫敦。

> **注意**：語言理解應用程式的工作是預測使用者的意圖，並識別套用意圖的任何實體。 語言理解應用程式的工作<u>並非</u>實際執行滿足意圖所需動作。 例如，時鐘應用程式可以使用語言應用程式來辨識使用者想要知道倫敦的時間；但用戶端應用程式本身必須接下來實作邏輯，以判斷正確的時間，並將其呈現給使用者。

## <a name="clone-the-repository-for-this-course"></a>複製本課程的存放庫

如果您尚未將 **AI-102-AIEngineer** 程式碼存放庫複製到您正此實驗室使用的環境，請遵循下列步驟來執行這項操作。 否則，請在 Visual Studio Code 中開啟複製的資料夾。

1. 啟動 Visual Studio Code。
2. 開啟調色盤 (SHIFT+CTRL+P) 並執行 **Git：複製**  命令，將 `https://github.com/MicrosoftLearning/AI-102-AIEngineer` 存放庫複製到本機資料夾 (哪個資料夾無關緊要)。
3. 複製存放庫後，請在 Visual Studio Code 中開啟此資料夾。
4. 等候其他檔案安裝以支援存放庫中的 C# 程式碼專案。

    > **注意**：如果系統提示您新增必要的資產來組建和偵錯，請選取 [現在不要]。

## <a name="create-language-understanding-resources"></a>建立語言理解資源

若要使用語言理解服務，您需要兩種資源：

- *製作* 資源：用於判斷、定型以及測試語言理解應用程式。 這必須是您的 Azure 訂用帳戶中的語言理解 - 製作資源。
- *預測* 資源：用於發佈語言理解應用程式，並處理來自使用該資源的用戶端應用程式之要求。 該資源可以是您的 Azure 訂用帳戶中的語言理解或認知服務資源。

     > **重要**：製作資源必須建立在三大區域 (歐洲、澳大利亞或美國) 中的某一個區域。 建立在歐洲或澳大利亞製作資源中的 Language Understanding 應用程式只能分別部署到位於歐洲或澳大利亞的預測資源；建立在美國製作資源中的模型可以部署到位於歐洲和澳大利亞之外的任何 Azure 位置的預測資源。 有關比對製作和預測位置的詳細資料，請參閱 [製作和發佈區域文件](https://docs.microsoft.com/azure/cognitive-services/luis/luis-reference-regions)。

如果您還沒有 Language Understanding 製作和預測資源：

1. 開啟 Azure 入口網站 (位於 `https://portal.azure.com`)，使用與您的 Azure 訂用帳戶相關聯的 Microsoft 帳戶進行登入。
2. 選取 [&#65291;建立資源] 按鈕、搜尋 [語言理解] ，並使用下列設定建立 [Language Understanding] 資源。

    *請確定您選取 [Language Understanding] ，<u>而不是 [Language Understanding (Azure 認知服務)]</u>*

    - **建立選項**：兩者
    - **訂用帳戶**：Azure 訂閱
    - **資源群組**：*選擇或建立資源群組 (如果您使用受限制的訂用帳戶，則可能沒有建立新資源群組的權限 - 請使用所提供的資源群組)*
    - **名稱**：*輸入唯一名稱*
    - **製作位置**：選取您慣用的位置
    - **製作定價層**：F0
    - **預測位置**：*與您的製作位置相同的位置*
    - **預測定價層**：F0
3. 等待資源建立，並注意兩種已建置的兩種語言理解資源；一種是製作資源，另一種是預測資源。 您可以透過導覽到建立其資源群組來檢視這兩種資源。 如果您選取 [移至資源]，則會開啟 [撰寫]  資源。

## <a name="create-a-language-understanding-app"></a>建立 Language Understanding 應用程式

既然您已建立製作資源，您可以使用其來建立Language Understanding 應用程式。

1. 在新的瀏覽器索引標籤中開啟 Language Understanding 入口網站 (位於 `https://www.luis.ai`)。
2. 使用與您 Azure 訂用帳戶建立關聯的 Microsoft 帳戶登入。 若這是您第一次登入語言理解入口網站，您可能需要授與應用程式一些權限以存取您的詳細帳戶資料。 然後選取您剛才建立的 Azure 訂用帳戶和製作資源，以完成 *「歡迎使用」* 步驟。

    > **注意**：如果您的帳戶與不同目錄中的多個訂用帳戶相關聯，您可能需要切換至包含您佈建 Language Understanding 資源之訂用帳戶的目錄。

3. 在 [交談應用程式] 頁面上，請確認已選取您的訂用帳戶和語言理解製作資源。 然後建立一個適用於交談且包含以下設定全新應用程式：
    - **名稱**：時鐘
    - **文化特性：** 英文 (如果此選項不可用，讓它保持空白)
    - **描述**：自然語言時鐘
    - **預測資源**：您的語言理解預測資源

    如果您的 **時鐘** 應用程式未自動開啟，請加以開啟。
    
    若顯示帶有建立有效語言理解應用程式的提示窗格，請將其關閉。

## <a name="create-intents"></a>建議意圖

我們在新應用程式中做的第一件事是定義一些意圖。

1. 在 [意圖] 頁面上，選取 [&#65291;建立] 以建立名為 **GetTime** 的新意圖。
2. 在 **GetTime** 意圖中，新增下列表達作為範例使用者輸入：

    *What is the time? (現在幾點？)*

    *What time is it? (現在幾點？)*

3. 新增這些表達之後，請返回 [意圖] 頁面，並使用下列表達新增另一個名為 **GetDay** 的新意圖：

    *what is the day today? (今天是星期幾？)*

    *What day is it? (今天是星期幾？)*

4. 新增這些表達之後，請返回 [意圖] 頁面，並使用下列表達新增另一個名為 **GetDay** 的新意圖：

    *what is the date today? (今天是幾月幾號？)*

    *what date is it? (今天是幾月幾號？)*

5. 新增這些表達之後，請返回 [意圖] 頁面，然後選取 [None] 意圖。 這會作為輸入的後援而提供，不會對應至您在語言模型中定義的任何意圖。
6. 將表達新增至 [None] 意圖：

    *hello*

    *Goodbye (再見)*

## <a name="train-and-test-the-app"></a>訓練及測試應用程式

既然您已新增一些意圖，讓我們定型該應用程式，並查看其是否可以正確地從使用者輸入預測意圖。

1. 在入口網站的右上方，選取 [定型] 以定型應用程式。
2. 定型應用程式後，選取 [測試] 以顯示 [測試面板]，然後輸入下列測試表達：

    *What's the time now? (現在幾點？)*

    檢閱傳回的結果，請注意，其包含預測的意圖 (應該是 **GetTime**)，並包含信賴度分數，指出模型針對預測的意圖計算出的可能性。

3. 請嘗試使用下列測試表達：

    *Tell me the time (請告訴我時間)*

    再次檢閱預測的意圖和信賴性分數。

4. 請嘗試使用下列測試表達：

    *what's today? (今天的日期是什麼？)*

    但願模型會預測 **GetDay** 意圖。

5. 最後，嘗試使用此測試表達：

    *hi*

    此操作應該會傳回 **None** 意圖。

6. 關閉 [測試] 面板。

## <a name="add-entities"></a>新增實體

到目前為止，您已定義一些對應至意圖的簡單表達。 大部分的實際應用程式都包含更複雜的表達，必須從中擷取特定資料實體，以取得意圖的更多內容。

### <a name="add-a-machine-learned-entity"></a>新增 *電腦學習* 的實體

最常見的實體類型是 *電腦學習* 實體，其中應用程式學習根據範例來識別實體值。

1. 在 [實體] 頁面上，選取 [&#65291;建立] 以建立新的實體。
2. 在 [建立實體] 對話方塊中，建立名為 [Location] 的 **機器學習** 實體。
3. 建立 **位置** 實體之後，返回 [意圖] 頁面，然後選取 [GetTime] 意圖。
4. 輸入下列新的範例表達：

    *What time is it in London? (倫敦現在幾點？)*

5. 新增表達之後，請選取 *[London]_ 這個字，然後在出現的下拉式清單中，選取 _[Location]* 以指出「London」是位置的範例。
6. 新增另一個表達範例：

    *what is the current time in New York?*

7. 新增表達之後，請選取 *[New York]_ 這個字，並將其對應至 _[Location]* 實體。

### <a name="add-a-list-entity"></a>新增 *清單* 實體

在某些情況下，實體的有效值可以限制為以特定字詞和同義字構成的清單；該清單可協助應用程式識別表達中實體的執行個體。

1. 在 [實體] 頁面上，選取 [&#65291;建立] 以建立新的實體。
2. 在 [建立實體] 對話方塊中，建立名為 [平日] 的 **清單** 實體。
3. 新增下列 **標準化值** 和 **同義字**：

    | 標準化值 | 同義字|
    |-------------------|---------|
    | Sunday | Sun |
    | Monday | 週一 |
    | Tuesday | Tue |
    | Wednesday | Wed |
    | Thursday | Thu |
    | Friday | Fri |
    | 星期六 | Sat |

3. 建立 **平日** 實體之後，返回 [意圖] 頁面，然後選取 [GetTime] 意圖。
4. 輸入下列新的範例表達：

    *what date was it on Saturday?*

5. 新增表達之後，請驗證 **星期六** 已自動對應至 [平日]實體。 如果沒有，請選取 [星期六] ***_這個字詞，然後在出現的下拉式清單中選取 _[平日]***。
6. 新增另一個表達範例：

    *what date will it be on Friday?*

7. 新增表達後，請確定 **星期五** 對應至 [平日]實體。

### <a name="add-a-regex-entity"></a>新增 *RegEx* 實體

有時候，實體具有特定格式，例如序號、表單字碼或日期。 您可以定義規則運算式 (*RegEx*)，其描述預期的格式，以協助您的應用程式識別相符的實體值。

1. 在 [實體] 頁面上，選取 [&#65291;建立] 以建立新的實體。
2. 在 [建立實體] 對話方塊中，使用下列 RegEx 建立名為 [Date] 的 **Regex** 實體：

    ```
    [0-9]{2}/[0-9]{2}/[0-9]{4}
    ```

    > **注意**：這是簡單的 RegEx，會檢查兩個數字後面接著「/」、另外兩個數位、另一個「/」以及四個數字 ，例如 *01/11/2020*。 其允許不正確日期，例如 *56/00/9999*；但請務必記住，實體 RegEx 是用來識別 *作為* 日期的資料輸入，而不是驗證日期值。

3. 建立 **日期** 實體之後，返回 [意圖] 頁面，然後選取 [GetTime] 意圖。
4. 輸入下列新的範例表達：

    *What day was 01/01/1901? (1901 年 1 月 1 日是星期幾？)*

5. 新增表達之後，請驗證 **01/01/1901** 已自動對應至 [日期] 實體。 如果未自動對應，請選取 [01/01/1901] ***_，然後在出現的下拉式清單中選取 _[Date]***。
6. 新增另一個表達範例：

    *what day will it be on 12/12/2099? (2099 年 12 月 12 日會是星期幾？)*

7. 新增表達後，請確定 **12/12/2099** 對應至 [日期] 實體。

### <a name="retrain-the-app"></a>重新定型該應用程式

既然您已修改語言模型，您必須重新定型並重新測試應用程式。

1. 在入口網站的右上方，選取 [定型] 以重新定型應用程式。
2. 定型應用程式後，選取 [測試] 以顯示 [測試面板]，然後輸入下列測試表達：

    *what's the time in Edinburgh? (愛丁堡現在幾點？)*

3. 檢閱傳回的結果，這但願預測了 **GetTime** 意圖。 然後選取 [檢查] ，然後在顯示的其他檢查面板中，檢查 [ML實體] 區段。 該模型應該已預測「edinburgh」是 **位置** 實體的執行個體。
4. 請嘗試測試下列表達：

    *星期五是幾號？*

    *週四是幾號？*

    *2020 年 1 月 1 日是星期幾？*

5. 當您完成測試後，請關閉檢查面板，但讓測試面板維持開啟狀態。

## <a name="perform-batch-testing"></a>執行批次測試

您可以使用測試窗格以互動方式來測試個別表達，但對於更複雜的語言模型，執行 *批次測試* 通常更有效率。

1. 在 Visual Studio Code　中，開啟 [09-luis-app] 資料夾中的 [batch-test.json] 檔案。 此檔案包含 JSON 文件，其中包含您建立之時鐘語言模型的多個測試案例。
2. 在 Language Understanding 入口網站的 [測試] 面板中，選取 [批次測試面板] 。 然後選取 [&#65291;匯入] ，並匯入 [batch-test.json] 檔案，指派 [clock-test] 名稱。
3. 在 [批次測試] 面板中，執行 [clock-test] 測試。
4. 當測試完成時，請選取 [查看結果]。
5. 在結果頁面上，檢視代表預測結果的混淆矩陣。 其會顯示右側清單中所選取意圖或實體的確判為真、誤判為真、確判為假及誤判為假預測。

    ![語言理解批次測試的混淆矩陣](./images/luis-confusion-matrix.jpg)

    > **注意**：每個表達都會針對每個意圖評分為 *真* 或 *假*，例如「現在幾點？」 應該將 **GetTime** 意圖的評分為 *真*，而 **GetDate** 意圖則為 *假*。 混淆矩陣上的點會顯示正確預測出哪些表達 (*true*)，且不正確 (*fals*) 為所選意圖的 *真* 和 *假*。

6. 選取 **GetDate** 意圖後，選取混淆矩陣上的任何點，以查看預測的詳細資料，包括表達和預測的信賴分數。 然後選取 [GetDay] 、[GetTime] 及 [None] 意圖，並檢視其預測結果。 應用程式應該在正確預測意圖方面做得很好。

    > **注意**：使用者介面可能無法清除先前選取的點。

7. 選取 [位置] 實體，然後在混淆矩陣中檢視預測結果。 特別是，請注意 *誤判為假* 的預測 - 這些是應用程式無法偵測表達中指定位置的情況，表示您可能需要將更多範例表達新增至意圖，然後重新定型模型。
8. 關閉批次測試面板。

## <a name="publish-the-app"></a>發佈應用程式

在實際專案中，您會反覆地完善意圖和實體、重新定型及重新測試，直到您對預測效能感到滿意為止。 然後，您可以發佈該應用程式以供用戶端應用程式使用。

1. 在 Language Understanding 入口網站的右上方，選取 [發佈]。
2. 選取 [生產位置]，然後發佈應用程式。
3. 發佈完成之後，在 Language Understanding 入口網站頂端，選取 [管理]。
4. 在 [設定] 頁面上，記下 [應用程式識別碼]。 用戶端應用程式需要此資訊才能使用您的應用程式。
5. 在 [Azure 資源] 頁面上，記下預測資源的 **主要金鑰**、**次要金鑰** 及 **端點 URL**，以供應用程式使用。 用戶端應用程式需要此端點和其中一個金鑰，才能連線到預測資源並進行驗證。
6. 在 Visual Studio Code 的 [09-luis-app] 資料夾中，選取 [GetIntent.cmd] 批次檔案，並檢視其所包含的程式碼。 此命令行指令碼會使用 cURL 呼叫指定應用程式和預測端點的 Language Understanding REST API。
7. 將指令碼中的預留位置值取代為 **應用程式識別碼**、**端點 URL**，以及您 Language Understanding 應用程式的 **主要金鑰** 或 **次要金鑰**；然後儲存更新的檔案。
8. 以滑鼠右鍵按一下 [09-luis-app] 資料夾，然後開啟整合式終端。 然後輸入下列命令 (請務必包含引號！)：

    ```
    GetIntent "What's the time?"
    ```

9. 檢閱應用程式所傳回的 JSON 回應，該回應應該表示為輸入預測的最高評分意圖 (應為 **GetTime**)。
10. 請嘗試下列命令：

    ```
    GetIntent "What's today's date?"
    ```

11. 檢查回應，並驗證其預測 **GetDate** 意圖。
12. 請嘗試下列命令：

    ```
    GetIntent "What time is it in Sydney?"
    ```

13. 檢查回應，並驗證其包含 **位置** 實體。

14. 請嘗試使用下列命令並檢查回應：

    ```
    GetIntent "What time is it in Glasgow?"
    ```

    ```
    GetIntent "What's the time in Nairobi?"
    ```

    ```
    GetIntent "What's the UK time?"
    ```
15. 請嘗試更多變化 - 目標是至少產生一些正確預測 **GetTime** 意圖，但無法偵測到 **Location** 實體的回應。

    讓終端保持開啟。 您稍後會回到終端。

## <a name="apply-active-learning"></a>套用 *主動式學習*

您可以根據提交至端點的歷程記錄表達來改善 Language Understanding 應用程式。 此做法稱為 *主動式學習*。

在上一個程序中，您已使用 cURL 將要求提交至應用程式的端點。 這些要求包含記錄查詢的選項，可讓應用程式追蹤該 查詢以用於主動式學習。

1. 在 Language Understanding 入口網站中，選取 [組建] 並檢視 [檢閱端點表達] 頁面。 此頁面會列出服務已標示要檢閱的記錄表達。
2. 對於意圖和新位置實體 (未包含在原始定型表達) 的任何表達，請選取 [&#10003;] 以確認實體，然後使用 [&#10514;] 圖示將表達新增至意圖作為定型範例。
3. 尋找已正確識別的 **GetTime** 意圖但 <u>未</u>識別的 **位置** 實體的表達範例；並選取位置名稱，並將其對應至 **位置** 實體。 然後使用 **&#10514;** 圖示，將表達新增至意圖作為定型範例。
4. 移至 [意圖] 頁面並開啟 [GetTime] 意圖，以確認已新增建議的表達。
5. 在 Language Understanding 入口網站頂端，選取 [定型] 以重新定型應用程式。
6. 在 Language Understanding 入口網站的右上方，選取 [發佈] ，並將應用程式重新發佈至 [生產位置] 。
7. 返回 [09-luis-app] 資料夾的終端，並使用 **GetIntent** 命令提交您在主動式學習期間新增及更正的表達。
8. 請驗證結果現在包含 **位置** 實體。 然後嘗試使用相同片語的另一個表達，但指定不同的位置 (例如 *柏林*)。

## <a name="export-the-app"></a>匯出應用程式

您可以使用 Language Understanding 入口網站來開發和測試您的語言應用程式，但在適用於 DevOps 的軟體開發流程中，您應該維護可包含在持續整合和傳遞 (CI/CD) 管線中的專案原始檔控制定義。 雖然您 *可以* 在程式碼指令碼中使用Language Understanding SDK 或 REST API 來建立和定型應用程式，但更簡單的方法是使用入口網站來建立應用程式，並將其匯出為可在另一個 Language Understanding 執行個體中匯入和重新定型的 *.lu* 檔案。 此方法可讓您利用入口網站的生產力優勢，同時維護應用程式的可攜性和重現性。

1. 在 Language Understanding 入口網站中，選取 [管理]。
2. 在 [版本] 頁面上，選取目前的應用程式版本 (頁面上應該只有一個)。
3. 在 [匯出] 下拉式清單中，選取 [匯出為 LU]。 然後，當瀏覽器提示您時，將檔案儲存在 [09-luis-app] 資料夾中。
4. 在 Visual Studio Code 中，如果系統提示您搜尋市場以取得可讀取的副檔名，請開啟您剛才匯出並下載的 **.lu** 檔案，並關閉提示。 請注意，LU 格式是人類可讀的，使其成為在小組開發環境中記錄 Language Understanding 應用程式定義的有效方式。

## <a name="more-information"></a>詳細資訊

如需使用 **Language Understanding** 服務的詳細資訊，請參閱 [Language Understanding 文件](https://docs.microsoft.com/azure/cognitive-services/luis/)。
